{"version":3,"sources":["updatePrice.js"],"names":["price","req","res","validatePricePrice","validation","body","error","status","json","details","message","orderId","params","id","orderIndex","order","findIndex","o","parseInt","originalOrder","newOrder","card_id","created_on","format","old_price_offered","price_offered","new_price_offered","car_id","data"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;;;AAEA,IAAMA,KAAK,GAAG,SAARA,KAAQ,CAACC,GAAD,EAAMC,GAAN,EAAc;AAAA,8BACRC,wBAAmBC,UAAnB,CAA8BH,GAAG,CAACI,IAAlC,CADQ;AAAA,MAClBC,KADkB,yBAClBA,KADkB;;AAE1B,MAAIA,KAAJ,EAAW;AACTJ,IAAAA,GAAG,CAACK,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACnBD,MAAAA,MAAM,EAAE,GADW;AAEnBD,MAAAA,KAAK,EAAEA,KAAK,CAACG,OAAN,CAAc,CAAd,EAAiBC;AAFL,KAArB;AAIA;AACD;;AACD,MAAMC,OAAO,GAAGV,GAAG,CAACW,MAAJ,CAAWC,EAA3B;;AACA,MAAMC,UAAU,GAAGC,kBAAMC,SAAN,CAAgB,UAAAC,CAAC;AAAA,WAAIA,CAAC,CAACJ,EAAF,KAASK,QAAQ,CAACP,OAAD,EAAU,EAAV,CAArB;AAAA,GAAjB,CAAnB;;AACA,MAAIG,UAAU,GAAG,CAAC,CAAlB,EAAqB;AACnB,QAAMK,aAAa,GAAGJ,kBAAMD,UAAN,CAAtB;;AACA,QAAIK,aAAa,CAACZ,MAAd,KAAyB,SAA7B,EAAwC;AACtCL,MAAAA,GAAG,CAACK,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACnBD,QAAAA,MAAM,EAAE,GADW;AAEnBD,QAAAA,KAAK,EAAE;AAFY,OAArB;AAIA;AACD;;AACD,QAAMc,QAAQ,GAAG;AACfP,MAAAA,EAAE,EAAEM,aAAa,CAACN,EADH;AAEfQ,MAAAA,OAAO,EAAEF,aAAa,CAACE,OAFR;AAGfC,MAAAA,UAAU,EAAE,0BAASC,MAAT,CAAgB,IAAhB,CAHG;AAIfhB,MAAAA,MAAM,EAAEY,aAAa,CAACZ,MAJP;AAKfiB,MAAAA,iBAAiB,EAAEL,aAAa,CAACM,aALlB;AAMfC,MAAAA,iBAAiB,EAAEzB,GAAG,CAACI,IAAJ,CAASoB;AANb,KAAjB;AAQAV,sBAAMD,UAAN,IAAoB;AAClBD,MAAAA,EAAE,EAAEM,aAAa,CAACN,EADA;AAElBc,MAAAA,MAAM,EAAER,aAAa,CAACQ,MAFJ;AAGlBL,MAAAA,UAAU,EAAEF,QAAQ,CAACE,UAHH;AAIlBf,MAAAA,MAAM,EAAEY,aAAa,CAACZ,MAJJ;AAKlBP,MAAAA,KAAK,EAAEmB,aAAa,CAACnB,KALH;AAMlByB,MAAAA,aAAa,EAAEL,QAAQ,CAACM;AANN,KAApB;AAQAxB,IAAAA,GAAG,CAACK,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACnBD,MAAAA,MAAM,EAAE,GADW;AAEnBqB,MAAAA,IAAI,EAAER;AAFa,KAArB;AAIA;AACD;;AACDlB,EAAAA,GAAG,CAACK,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACnBD,IAAAA,MAAM,EAAE,GADW;AAEnBD,IAAAA,KAAK,EAAE;AAFY,GAArB;AAID,CA9CD;;eAgDeN,K","sourceRoot":"G:\\Auto-Mart-Website\\server\\controllers","sourcesContent":["import moment from 'moment';\r\nimport validatePricePrice from '../helpers/updatePrice';\r\nimport order from '../models/order';\r\n\r\nconst price = (req, res) => {\r\n  const { error } = validatePricePrice.validation(req.body);\r\n  if (error) {\r\n    res.status(400).json({\r\n      status: 400,\r\n      error: error.details[0].message,\r\n    });\r\n    return;\r\n  }\r\n  const orderId = req.params.id;\r\n  const orderIndex = order.findIndex(o => o.id === parseInt(orderId, 10));\r\n  if (orderIndex > -1) {\r\n    const originalOrder = order[orderIndex];\r\n    if (originalOrder.status !== 'pending') {\r\n      res.status(400).json({\r\n        status: 400,\r\n        error: 'you can change the price of pending purchasing orders only',\r\n      });\r\n      return;\r\n    }\r\n    const newOrder = {\r\n      id: originalOrder.id,\r\n      card_id: originalOrder.card_id,\r\n      created_on: moment().format('LL'),\r\n      status: originalOrder.status,\r\n      old_price_offered: originalOrder.price_offered,\r\n      new_price_offered: req.body.price_offered,\r\n    };\r\n    order[orderIndex] = {\r\n      id: originalOrder.id,\r\n      car_id: originalOrder.car_id,\r\n      created_on: newOrder.created_on,\r\n      status: originalOrder.status,\r\n      price: originalOrder.price,\r\n      price_offered: newOrder.new_price_offered,\r\n    };\r\n    res.status(200).json({\r\n      status: 200,\r\n      data: newOrder,\r\n    });\r\n    return;\r\n  }\r\n  res.status(404).json({\r\n    status: 404,\r\n    error: 'order not found',\r\n  });\r\n};\r\n\r\nexport default price;\r\n"]}